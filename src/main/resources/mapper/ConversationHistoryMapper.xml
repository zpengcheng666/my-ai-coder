<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--suppress ALL -->
<mapper namespace="org.example.ai.mapper.ConversationHistoryMapper">


    <select id="selectByConversationIdOrderByCreateTimeAsc" resultType="org.example.ai.entity.ConversationHistory">
        SELECT * FROM conversation_history 
        WHERE conversation_id = #{conversationId} 
        ORDER BY create_time ASC
    </select>

    <select id="selectByUserIdOrderByCreateTimeDesc" resultType="org.example.ai.entity.ConversationHistory">
        SELECT * FROM conversation_history 
        WHERE user_id = #{userId} 
        ORDER BY create_time DESC
    </select>

    <select id="selectByUserIdAndCreateTimeBetween" resultType="org.example.ai.entity.ConversationHistory">
        SELECT * FROM conversation_history 
        WHERE user_id = #{userId} 
        AND create_time BETWEEN #{startTime} AND #{endTime} 
        ORDER BY create_time DESC
    </select>

    <select id="countByUserId" resultType="long">
        SELECT COUNT(*) FROM conversation_history 
        WHERE user_id = #{userId}
    </select>

    <select id="sumTokenUsedByUserId" resultType="long">
        SELECT SUM(token_used) FROM conversation_history 
        WHERE user_id = #{userId}
    </select>

    <delete id="deleteByCreateTimeBefore">
        DELETE FROM conversation_history 
        WHERE create_time &lt; #{time}
    </delete>
    
    <delete id="deleteByConversationId">
        DELETE FROM conversation_history 
        WHERE conversation_id = #{conversationId}
    </delete>

</mapper>